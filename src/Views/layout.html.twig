<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Graphgen |Â Neoxygen.io</title>
    <link rel="icon" href="{{ app.request.basepath }}/favicon.ico" type="image/x-icon">

    <!-- Bootstrap core CSS -->
    <link href="{{ app.request.basepath }}/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{ app.request.basepath }}/assets/alchemyjs/dist/styles/vendor.css" rel="stylesheet">
    <link href="{{ app.request.basepath }}/assets/alchemyjs/dist/alchemy.min.css" rel="stylesheet">
    <link href="{{ app.request.basepath }}/assets/codemirror/lib/codemirror.css" rel="stylesheet">
    <link href="{{ app.request.basepath }}/assets/codemirror/theme/neo.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>


    <![endif]-->
    <style>
        body { padding-top: 70px; }

        #alchemy {
            height: 100px;
        }

        .CodeMirror {
            height: 200px;
        }

        #ggbrand {
            color: #1DC116;
        }

        #ggbrand span {
            color: #fff;
            font-size: 12px;
            margin-left: 2px;
        }

        #linkToRepo {
            font-size: 13px;
        }

        #linkToRepo:hover {
            text-decoration: none;
        }

        #desc {
            color: #fff;
        }

        #desc a.neolink {
            color: #1DC116;
        }

        .exportButtons {
            text-align: right;
            display: none;
        }

        #footer {
            height: 60px;
            background-color: #f5f5f5;
            padding-top: 20px;
            margin-top:10px;
        }

    </style>

    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
                m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-55552990-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>
<body>

<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="{{ path('home') }}" id="ggbrand">Graphgen<span>&beta;eta</span></a>
            <p class="navbar-text" id="desc">Graph generator for <a href="http://neo4j.org" title="Neo4j" class="navbar-link neolink">Neo4j</a></p>
        </div>
        <ul class="nav navbar-nav navbar-right">
            <li class=""><a href="{{ path('doc') }}">Docs</a></li>
            <li class=""><a href="http://www.neoxygen.io" target="_blank">Neoxygen.io</a></li>
            {% if current > 0 %}
                <li><a href="#">{{ current }} graphs generated</a></li>
            {% endif %}
            <li><a href="https://github.com/neoxygen/graphgen" title="Fork me I'm famous" id="linkToRepo">
                    <img src="{{ app.request.basepath }}/assets/images/ghmarklight.png" alt="Github Repository"/></a></li>
        </ul>
        <div class="collapse navbar-collapse">
        </div>
    </div>
</div>

<div class="container">
    {% block content %}
    {% endblock content %}

</div>

<div id="footer">
    <div class="container">
        <div class="col-xs-12">
            <p>Brought to you by <a href="https://twitter.com/ikwattro" title="Christophe Willemsen">Christophe Willemsen | @ikwattro</a></p>
        </div>
    </div>
</div>

{% block javascripts %}
    <script src="{{ app.request.basepath }}/assets/jquery/dist/jquery.min.js"></script>
    <script src="{{ app.request.basepath }}/assets/bootstrap/js/collapse.js"></script>
    <script src="{{ app.request.basepath }}/assets/alchemyjs/dist/scripts/vendor.js"></script>
    <script src="{{ app.request.basepath }}/assets/alchemyjs/dist/alchemy.js"></script>
    <script src="{{ app.request.basepath }}/assets/codemirror/lib/codemirror.js"></script>
    <script src="{{ app.request.basepath }}/assets/codemirror/mode/cypher/cypher.js"></script>
    <script src="{{ app.request.basepath }}/assets/site/populator.js"></script>

    <script type="text/javascript">
        $(document).ready(function() {

            $('.exportButtons').hide();
            // Instantiate code editor

            var editor = CodeMirror.fromTextArea(document.getElementById("patternBox"), {
                lineNumbers: true,
                mode: "application/x-cypher-query",
                matchBrackets: true,
                autofocus: true,
                theme: 'neo'
            });


            $('#patternForm').submit(function (e) {
                e.preventDefault();
                var apiEndpoint = $(this).attr('action');
                var pattern = $('#patternBox').val();
                var posting = $.post(apiEndpoint, {'pattern': pattern});
                posting.done(function (data) {
                    $('#cypherError').hide();
                    var data = $.parseJSON(data);
                    console.log(data);
                    g = {
                        nodes: [],
                        edges: []
                    };
                    $.each(data.nodes, function (index, node) {
                        g.nodes.push({
                            id: node._id,
                            label: node.laebl,
                            caption: node.label,
                        });
                    });

                    $.each(data.edges, function (index, edge) {
                        g.edges.push({
                            source: edge._source,
                            target: edge._target,
                            caption: edge.type
                        });
                    });

                    var config = {
                        dataSource: g,
                        forceLocked: true,
                        collisionDetection: true,
                        edgeArrowSize: 2,
                        directedEdges: true,
                        zoomControls: true,
                        initialScale: 0.5
                    };
                    $('#gjson_result').html(pattern);
                    $('#alchemy').css('min-height', '600px');
                    alchemy.begin(config);
                    $('.exportButtons').show();


                });
                posting.fail(function(data){
                    var error = data.responseJSON.error;
                    console.log(error);
                    $('#cypherError').html('<p>' + error.message + '</p>');
                    $('#cypherError').show();
                });

            });

            $('#exportToGraphJson').submit(function(e){
                var pattern = $('#gjson_result').html();
                $('#gjson_pattern').val(pattern);
            });

            $('#exportToCypher').submit(function(e){
                var pattern = $('#gjson_result').html();
                $('#cypher_pattern').val(pattern);
            });
        });
    </script>
{% endblock javascripts %}
</body>
</html>